/*=================================================
recommend do not edit this file
=================================================*/
var $ = jQuery.noConflict();

(function($) {
  'use strict';

/*==============================================================================
variable
==============================================================================*/
var $html = $('html');
var $body = $('body');

/*==============================================================================
ie10 viewport fix
==============================================================================*/
  (function() {
    'use strict';
    if (navigator.userAgent.match(/IEMobile\/10\.0/)) {
      var msViewportStyle = document.createElement('style')
      msViewportStyle.appendChild(
        document.createTextNode(
          '@-ms-viewport{width:auto!important}'
        )
      )
      document.querySelector('head').appendChild(msViewportStyle)
    }
  })();

/*==============================================================================
device detect
==============================================================================*/
  if ($html.hasClass('desktop')) {
    $html.addClass('non-mobile');
    var isMobile = false;
  } else {
    $html.addClass('is-mobile');
    var isMobile = true;
  }
  if ($html.hasClass('ie9')) {
    var isIE9 = true;
  }

/*==============================================================================
site loader
==============================================================================*/
  function fn_siteLoader() {
    $('.char, .col-countdown, .section-divider').css('opacity', 0);
    $('.word').css('display', 'inline-block');

    var delay = _siteLoaderDelay + _siteLoaderDuration - 400
    var easing = [0.710, 0.100, 0.3, 1.000];
    var titleCount = $('.section-title .char').length;
    var subtitleCount = $('.section-subtitle .char').length;
    var stagger1 = _animationDuration/titleCount;
    var stagger2 = _animationDuration/subtitleCount;
    var stagger3 = _animationDuration;

    /* Registration */
    $.Velocity
      .RegisterEffect('transition.bfcSlideDownIn_60', {
        defaultDuration: 800,
        calls: [
          [ { translateZ: 0, translateY: [0, '60px'], opacity: [ 1, 0 ] } ]
        ]
      })
      .RegisterEffect('transition.bfcSlideUpIn_-60', {
        defaultDuration: 800,
        calls: [
          [ { translateZ: 0, translateY: [0, '-60px'], opacity: [ 1, 0 ] } ]
        ]
      })
      .RegisterEffect('transition.bfcSlideUpIn_15', {
        defaultDuration: 800,
        calls: [
          [ { translateZ: 0, translateY: [0, '15px'], opacity: [ 1, 0 ] } ]
        ]
      })
      .RegisterEffect('transition.bfcSlideDownIn_-15', {
        defaultDuration: 800,
        calls: [
          [ { translateZ: 0, translateY: [0, '-15px'], opacity: [ 1, 0 ] } ]
        ]
      });

    var $siteLoader = $('#site-loader');

    $(window).on('load', function() {
      $siteLoader.velocity({
        translateZ: 0,
        translateY: '-100%'
      }, {
        delay: _siteLoaderDelay,
        duration: _siteLoaderDuration,
        easing: easing,
        complete: function() {
          $(this).remove();
        }
      });

      $('#site-wrap').velocity({
        translateZ: 0,
        translateY: [0, '70%']
      }, {
        delay: _siteLoaderDelay,
        duration: _siteLoaderDuration,
        easing: easing
      });

      $('#home .section-title .char:nth-child(odd)').velocity('transition.bfcSlideDownIn_60', {
        display: 'inline-block',
        stagger: stagger1,
        easing: easing,
        delay: delay
      });
      $('#home .section-title .char:nth-child(even)').velocity('transition.bfcSlideUpIn_-60', {
        display: 'inline-block',
        stagger: stagger1,
        easing: easing,
        delay: delay
      });

      $('#home .section-subtitle .char:nth-child(odd)').velocity('transition.bfcSlideUpIn_15', {
        display: 'inline-block',
        stagger: stagger2,
        easing: easing,
        delay: delay
      });
      $('#home .section-subtitle .char:nth-child(even)').velocity('transition.bfcSlideDownIn_-15', {
        display: 'inline-block',
        stagger: stagger2,
        easing: easing,
        delay: delay
      });

      $('.col-countdown:nth-child(odd)').velocity('transition.bfcSlideDownIn_60', {
        display: 'inline-block',
        duration: _animationDuration,
        easing: easing,
        delay: delay
      });
      $('.col-countdown:nth-child(even)').velocity('transition.bfcSlideUpIn_-60', {
        display: 'inline-block',
        duration: _animationDuration,
        easing: easing,
        delay: delay
      });

      $('.section-divider').velocity({
        translateZ: 0,
        scaleX: [1, 0],
        opacity: [1, 0]
      }, {
        duration: _animationDuration - 500,
        easing: easing,
        delay: delay
      });
    });
  }

/*==============================================================================
core
==============================================================================*/
  function fn_core() {

    // bind click event to all internal page anchors
    $('a[href="#"]').bind('click', function(e) {
      e.preventDefault();
    });

    // add style class
    $body.addClass(_mainColor);
    $('head').append(
      '<style id="js-css">' +
       '.light #overlay { background-color: ' + _lightOverlayColor + '; }' +
       '.light #form { background-color: ' + _lightFormOverlayColor + '; }' +
       '.dark #overlay { background-color: ' + _darkOverlayColor + '; }' +
       '.dark #form { background-color: ' + _darkFormOverlayColor + '; }' +
      '</style>'
    );

    if (_border) {
      $body.addClass('is-border');
    }
  }

/*=================================================
effect
=================================================*/
  function fn_effect() {
    if (_effect == 0) {
      $('#effect, #js-canvas').remove();
    } else if (_effect == 1) {
      fn_cloud();
    } else if (_effect == 2) {
      fn_star();
    }
  }

  function fn_star() {
    var $canvas = $('#js-canvas');

    $('#effect').remove();
    $body.addClass('is-star');

    function callCanvas (canvas) {
      var screenpointSplitt = 14000
      var movingSpeed = 0.2
      var viewportWidth = $(window).width();
      var viewportHeight = $(window).height();
      var nbCalculated = Math.round(viewportHeight*viewportWidth/screenpointSplitt);

      var $this = $(this),
      ctx = canvas.getContext('2d');
      $this.config = {
        star: {
          color: _starColor,
          width: _starWidth
        },
        line: {
          color: _starColor,
          width: 0.4
        },
        position: {
          x: canvas.width * 0.5,
          y: canvas.height * 0.5
        },
        velocity: movingSpeed,
        length: nbCalculated,
        distance: 130,
        radius: 120,
        stars: []
      };

      function Star () {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;

        this.vx = ($this.config.velocity - (Math.random() * 0.3));
        this.vy = ($this.config.velocity - (Math.random() * 0.3));

        this.radius = Math.random() * $this.config.star.width;
      }

      Star.prototype = {
        create: function(){
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
          ctx.fill();
        },

        animate: function(){
          var i;
          for(i = 0; i < $this.config.length; i++){

            var star = $this.config.stars[i];

            if(star.y < 0 || star.y > canvas.height){
              star.vx = star.vx;
              star.vy = - star.vy;
            }
            else if(star.x < 0 || star.x > canvas.width){
              star.vx = - star.vx;
              star.vy = star.vy;
            }
            star.x += star.vx;
            star.y += star.vy;
          }
        },

        line: function(){
          var length = $this.config.length,
            iStar,
            jStar,
            i,
            j;

          for(i = 0; i < length; i++){
            for(j = 0; j < length; j++){
              iStar = $this.config.stars[i];
              jStar = $this.config.stars[j];

              if(
                (iStar.x - jStar.x) < $this.config.distance &&
                (iStar.y - jStar.y) < $this.config.distance &&
                (iStar.x - jStar.x) > - $this.config.distance &&
                (iStar.y - jStar.y) > - $this.config.distance
              ) {
                if(
                  (iStar.x - $this.config.position.x) < $this.config.radius &&
                  (iStar.y - $this.config.position.y) < $this.config.radius &&
                  (iStar.x - $this.config.position.x) > - $this.config.radius &&
                  (iStar.y - $this.config.position.y) > - $this.config.radius
                ) {
                  ctx.beginPath();
                  ctx.moveTo(iStar.x, iStar.y);
                  ctx.lineTo(jStar.x, jStar.y);
                  ctx.stroke();
                  ctx.closePath();
                }

              }
            }
          }
        }

      };
      $this.createStars = function () {
        var length = $this.config.length,
          star,
          i;

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for(i = 0; i < length; i++){
          $this.config.stars.push(new Star());
          star = $this.config.stars[i];
          star.create();
        }

        star.line();
        star.animate();
      };

      $this.setCanvas = function () {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      };

      $this.setContext = function () {
        ctx.fillStyle = $this.config.star.color;
        ctx.strokeStyle = $this.config.line.color;
        ctx.lineWidth = $this.config.line.width;
        ctx.fill();
      };

      $this.loop = function (callback) {
        callback();
        reqAnimFrame(function () {
          $this.loop(function () {
            callback();
          });
        });
      };

      $this.bind = function () {
        $(window).on('mousemove', function(e){
          $this.config.position.x = e.pageX;
          $this.config.position.y = e.pageY;
        });
      };

      $this.init = function () {
        $this.setCanvas();
        $this.setContext();

        $this.loop(function () {
          $this.createStars();
        });

        $this.bind();
      };

      return $this;
    }

    var reqAnimFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || function (callback) {
      window.setTimeout(callback, 1000 / 60);
    };

    $canvas.hide();

    $(window).on('load', function() {
      setTimeout(function () {
        callCanvas($('canvas')[0]).init();
        $canvas.velocity('transition.fadeIn', {
          duration: 3000
        });
      }, 2000);
    });

    var waitForFinalEvent = (function () {
      var timers = {};
      return function (callback, ms, uniqueId) {
      if (!uniqueId) {
        uniqueId = '';
      }
      if (timers[uniqueId]) {
        clearTimeout (timers[uniqueId]);
      }
      timers[uniqueId] = setTimeout(callback, ms);
      };
    })();

    $(window).resize(function () {
      waitForFinalEvent(function(){
        callCanvas($('canvas')[0]).init();
      }, 800, '');
    });
  }

/*==============================================================================
scrollbar
==============================================================================*/
  function fn_scrollbar() {
    var $scrollBlock = $('section, #form');
    if (isMobile) {
      $scrollBlock.addClass('mobile-scroll');
    } else {
      $scrollBlock.perfectScrollbar({
        suppressScrollX: true
      });
    }
  }

/*=================================================
ie9 placeholder
=================================================*/
  function fn_placeholder() {
    if (isIE9) {
      $('input, textarea').placeholder({customClass: 'placeholder'});
    }
  }

/*=================================================
background control
=================================================*/
  function fn_bgStyle() {
    if (_bgStyle == 1) {
      fn_imgBg();
    } else if (_bgStyle == 2) {
      fn_slider();
    } else if (_bgStyle == 3) {
      fn_videoBg();
    } else if (_bgStyle == 4) {
      fn_ytVideoBg();
    }
  }

/*=================================================
 * image background
=================================================*/
  function fn_imgBg() {
    $('#video').remove();
    $body.addClass('is-img');
  }

  function fn_slider() {
    $('#video').remove();
    $body.addClass('slider-bg');
    for (var i = 1; i <= _imgAmount; i++) {
      $('#img').append('<img src="/Content/backgrounds/public/bg-' + (i < 10 ? '0' + i : i) + '.jpg">');
    }

    $(window).on('load', function() {
      if (_kenburn == 1) {
        $('#img').kenburnsy({
          fullscreen: true,
          duration: 9000,
          fadeInDuration: 1500
        });
      } else {
        $('#img').ss({
          fullscreen: true,
          duration: 9000,
          fadeInDuration: 1500
        });
      }
    });
  }

/*=================================================
document on ready
=================================================*/
  $(document).on('ready', function() {

    fn_core();
    fn_siteLoader();
    fn_scrollbar();
    fn_bgStyle();
    fn_effect();

  });

/*=================================================
window on resize
=================================================*/
  $(window).on('resize', function() {

  });

})(jQuery);